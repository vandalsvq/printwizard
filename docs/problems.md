# Проблемы в пути

## Сборка расширения без использования конфигуратора

Планировалось реализовать сборку расширения и внешней обработки без использования конфигуратора. Например, при помощи [v8unpack](https://github.com/e8tools/v8unpack). Однако, при сборке расширения (измененного) необходимо пересчитывать его хеш-сумму. Компонента этого либо не делает, либо делает некорректно. В результате, после изменения состава расширения, оно собирается, но увы не может быть использовано.

Пришлось сборку выполнять при помощи конфигуратора.

## Сериализация табличного документа (MXL) в xml файл

Планировалось при сборке внешней печатной формы в качестве макета вставлять табличный документ (как принято обычно). Сериализация табличного документа в xml в целом работает корректно (код см. ниже). 

```
	ЗаписьXML = Новый ЗаписьXML;
	ЗаписьXML.УстановитьСтроку();
	СериализаторXDTO.ЗаписатьXML(ЗаписьXML, ТабДокумент, "document", "http://v8.1c.ru/8.2/data/spreadsheet");
	Возврат ЗаписьXML.Закрыть();
```

Но замечены следующие артефакты:

* отсутствует первая строка `<?xml version="1.0" encoding="UTF-8"?>`. Возможно мы некорректно вызвали метод сериализации
* в xml данные о языке табличного документа записываются в следующем виде `<v8:lang>#</v8:lang>`. Необходимо выполнять замену с учетом основного языка.
```
	ОсновнойЯзыкXML = ?(ПустаяСтрока(КодОсновогоЯзыка), "", "<v8:lang>" + КодОсновогоЯзыка + "</v8:lang>");
	СтрокаXML = СтрЗаменить(СтрокаXML, "<v8:lang>#</v8:lang>", ОсновнойЯзыкXML);
```
* если в табличном документе используются предопределенные элементы стиля, или элементы стиля конфигурации, они некорректно сериализуются. В результате средствами платформы обработка не может быть собрана. Варианта два:
  * при изменении области преобразовывать элемент стиля в цвет. Недостаток: цвет останется фиксированный и не будет изменен в другой конфигурации. Пользователь может посчитать это ошибкой
  * сохранять макет в обработке печати в виде двоичных данных, тогда проблемы нет
Расширение использовует второй метод. При выгрузке во внешнюю печатную форму табличный документ сохраняется в макет в виде двоичных данных

## Предопределенный элемент стиля в цвет

Предопределенный элемент стиля не содержит данные RGB о цвете. Для получения корректных данных о цвете можно использовать следующую конструкцию:

```
Функция ЭлементСтиляВЦвет(знач Цвет)
	ТекстHTML = "";
	
	ФД = Новый ФорматированныйДокумент;
	ФД.УстановитьФорматированнуюСтроку(Новый ФорматированнаяСтрока(" ",, Цвет));
	ФД.ПолучитьHTML(ТекстHTML, Неопределено);
	
	ПозицияЦвета = СтрНайти(ТекстHTML, "#");
	ЧислоHEX = Сред(ТекстHTML, ПозицияЦвета, 7);
	
	Возврат HexВЦвет(ЧислоHEX); // реализация данного метода не приложена
КонецФункции
```