# Создание простой печатной формы

В данной ветке мы подробно рассмотрим пример создания простой печатной формы с помощью Мастера печатных форм. Пример целиком основан на использовании визуальных средств разработки (без программирования).

Обратите внимание, что действия описанные в данной инструкции будут применяться для создания и более сложных печатных форм, поэтому данное руководство будет полезно как аналитикам, так и разработчикам.  

Практическое знакомство с инструментарием Мастера печатных форм начнем с простой формы Счет на оплату.

<img src="img/ФормаСчетаНаОплату.png">



## Создание проекта

На главной странице Мастера печатных форм нажмите кнопку **Создать**:

<img src="img/СозданиеПроекта.png">

Заполните *Наименование*:

<img src="img/МакетНаименование.png">

Мы создали проект. далее необходимо определить, что будет являться источником отбора данных для печатной формы - вкладка **Метаданные**. В нашем примере это документ Счет на оплату покупателю. Из него мы планируем выводить на печать форму.

На вкладке Метаданные нажмите **Добавить** и выберите Объект метаданных из предложенного списка:

<img src="img/ВыборМетаданных.png">

Поставьте **флаг "Добавить команду печати на форму объекта"**, чтобы добавить кнопку печати на форму объекта метаданных (на форму документа Счет на оплату покупателю):

<img src="img/ФлагПечати.png">

При желании есть возможность изменить *Настройки команды печати*, заданные по умолчанию.

<img src="img/НастройкиПечати.png">

Следующий шаг - отрисовка макета будущей печатной формы, для этого в ***PrintWizard*** предусмотрены различные механизмы облегчающие данную задачу.

## Загрузка макета

Доступно три варианта загрузки готового макета:

* Из макета объекта

* Из общего макета

* Из файла на диске

<img src="img/ЗагрузкаМакета.png">

:bulb: **Загрузка макета доступна только в режиме Редактирования макета**

## Создание макета вручную

<img src="img/МакетВорд.png">

Для начала выберите формат макета, по умолчанию выбран табличный формат, при необходимости измените данную настройку с помощью флага **Макет в формате Open Office Documents (* .docx)**

В нашем примере мы рассмотрим наиболее простой вариант - табличный.

Табличный формат редактируется на вкладке Макет, с помощью активирования кнопки **Редактирование**.

<img src="img/РедактированиеМакет.png">

Для помощи при создании макета на верхней панели вкладки **Макет** и в меню **Еще** вы найдете множество настроек, предназначенных для редактирования текста, объединения/разъединения ячеек, задания границ и т.д.

<img src="img/НастройкиМакета.png">

### Задание Областей макета

Области макета предназначены для однократного или многократного вывода информации содержащейся в данной области.

Область может состоять из нескольких расположенных подряд строк или колонок, либо быть прямоугольной областью таблицы.

Чтобы добавить Области макета выделите нужные строки на форме редактирования и нажмите кнопку **Назначить имя** (см. картинку). Соответственно, чтобы удалить Область воспользуйтесь кнопкой справа от неё.

Области в макете отделены красными линиями.

<img src="img/ДобавлениеОбласти.png">

:bulb: **Имя Области может начинаться только с буквы и содержать только буквы, цифры и символ “_“**

В нашем примере зададим следующие Области:

* ПлатежныеРеквизиты

* ЗаголовокСчета

* Поставщик

* Покупатель

* ШапкаТаблицы

* Строка

* Итого

* ИтогоНДСВСумме

* Подвал

:bulb: **Области лучше разделять с учетом Способов вывода (См. ***Способы вывода областей макета***), например таблицу всегда нужно выводить в отдельной области, т.к. строки в ней могут повторяться в зависимости от количества данных.**

Добавленные Области появятся на форме **Области макета**:

<img src="img/ОбластиМакета.png">

На данной форме редактируется **Способ вывода** каждой области:

<img src="img/СпособВывода.png">

### Способы вывода областей макета

* Без повторений - Данным способом область выводится в печатной форме один раз, в основном используется для вывода шапки документа

* По строкам коллекции - 

* Перенос строки -

* Контрольная строка - 

* Строка переноса - 

* Пустая область - 

* Не выводить на печать - 

В нашем примере все данные в макете будут выводиться один раз (Способ вывода - *Без повторений*), кроме Области *Строка*, так как в данной области будут отражены данные из табличной части по количеству строк в документе. Соответственно Способ вывода необходимо выбрать - *По строкам коллекции*.

### Задание Параметров

После задания Областей необходимо задать Параметры в макете, которые в дальнейшем будут использоваться для вывода данных на печать. Для этого воспользуемся **панелью Свойств**.

**Панель Свойств** можно добавить/убрать на рабочий экран с помощью кнопки на верхней панели вкладки Макет:

<img src="img/ПанельСвойств.png">

:bulb: **Расширенную версию панели Свойств (включая настройки Значения, Оформления и настройки Картинок) можно открыть с помощью клика ПКМ - Свойства, либо по кнопке Еще - Свойства, либо одновременным нажатием клавиш Alt+Enter**

:bulb: **Параметры в Макете необходимо задавать в угловых скобках “<>”, в Шаблонах Параметры необходимо задавать в квадратных скобках “[]“.**

В нашем примере:

Задаем Параметр в Области "Поставщик" - <Поставщик> - предполагаем, что в него будет выводиться ФИО поставщика. Для этого, стоя на ячейке <Поставщик>, на **панели Свойств** в **Значение** выбираем *Параметр*.

<img src="img/Параметр.png">

Задаем Шаблон в Области ЗаголовокСчета - "Счет на оплату № [НомерДокумента] от [ДатаДокумента]" - предполагаем, что в него будет выводиться Счет на оплату с номером и датой. Для этого, стоя на ячейке на **панели Свойств** выбираем **Значение** - *Шаблон*.

<img src="img/Шаблон.png">

Наш макет готов к использованию. Следующим Шагом необходимо задать откуда берутся данные для Вывода в Параметрах.

Получение данных для печатной формы состоит из двух этапов:

1. **Запрос** к базе данных на получение исходных данных - "сырые данные". То есть в чистом виде они не всегда пригодны для использования в макете и чаще всего требуют обработки

2. Манипуляция с данными из Запроса с целью подготовить удобные **Наборы** для вывода в печатную форму

## Создание запросов

Создадим Запросы для печатной формы Счет на оплату покупателю. Для того чтобы автоматически сформировать Запросы на основании выбранных метаданных на вкладке Запросы нажмем кнопку Обновить (см. скрин):

<img src="img/ОбновитьЗапрос.png">

По данной кнопке табличная часть слева автоматически заполняется Запросами на основании Метаданных, в табличной части (ТЧ) Текст запроса попадает текст запроса, а в ТЧ Поля запроса отображается список полей из соответствующего запроса с указанием Типов данных.

Созданные автоматически Запросы можно редактировать с помощью **Конструктора запроса** и **Специального редактора**.

<img src="img/ТекстЗапроса.png">

Для нашего примера нет необходимости создавать дополнительные Запросы. Обо всех возможностях вкладки Запросы см. здесь [Работа с запросами](docs/docs\query\Работа-с-запросами.md).

Но у нас есть поля, которые не были получены с помощью автоматического запроса, такие как: ИНН и Полное наименование Организации, ФИО Руководителя и ФИО Главного бухгалтера. Эти данные мы сможем получить пополнив один из запросов данными из Справочника Организации.

Эти данные мы добавим к готовому запросу с помощью **Конструктора запроса**. Для этого, находясь на строке того Запроса, куда хотим добавить недостающие данные, нажмем кнопку **Конструктор запроса**.

<img src="img/КонструкторЗапроса.png">

На вкладке **Таблицы и поля** в раскрывающемся списке Таблицы раскроем **Т**, выберем необходимые поля и двойным щелчком мыши добавим их по очереди в **Поля** в правой части конструктора и нажмем ***ОК***. 

<img src="img/КонструкторЗапросаФорма.png">

Поля автоматически попадут в Запрос:

<img src="img/ПримерЗапрос.png">

Чтобы вновь добавленные поля попали в ТЧ Поля запроса нажмём кнопку **Обновить**:

<img src="img/ПримерПоляЗапроса.png">

ФИО Главного бухгалтера и Директора добавим таким же образом.

:bulb: **Выбирайте поля с Типом строка чтобы в дальнейшем их можно было использовать в печатной форме.**

Также, любой запрос можно редактировать вручную с помощью удобного помощника - Редактора запросов:

<img src="img/РедакторЗапросов.png">

Запросы для нашей печатной формы готовы. Следующий шаг - создание Наборов данных на основе созданных Запросов.

## Создание Наборов

Для того чтобы автоматически сформировать Наборы на основании Запросов на вкладке Наборы нажмем кнопку **Обновить**:

<img src="img/ОбновитьНабор.png">

По данной кнопке табличная часть слева автоматически заполняется Наборами на основании Запросов.

<img src="img/НаборыСписок.png">

На этой же форме редактируется *Вид набора*:

* Первая строка - используется, когда нужна первая строка в таблице или данные и есть Строка.

* Последняя строка - используется когда нужна последняя строка в таблице

* Соединение строк - используется, когда нужно перечисление через разделитель “;“

* Многострочная коллекция - используется для данных таблиц.

<img src="img/ВидНабора.png">

Обновим Поля необходимых нам наборов с помощью кнопки **Обновить**. На выбор предлагается Обновить данные из:

* Запроса

* Алгоритма

* Набора

<img src="img/ОбновитьНаборыИз.png">

## Сопоставление данных наборов с параметрами в макете

Теперь, когда мы подготовили необходимые наборы данных, чтобы печатная форма заработала необходимо сопоставить заданные нами Параметры в макете с данными из подготовленных наборов.

Для этого необходимо перейти на вкладку **Макет** в табличную часть Параметры области.

:bulb: **Если в Табличной части Области макета Способ вывода - По строкам коллекции, необходимо выбрать Набор данных для этой области, и, в случае если наименования Значения из наборов совпадает с наименованием Параметра в Макете, при нажатии на кнопку Заполнить значения заполнятся автоматически.**

<img src="img/НаборВТЧОбласти.png">

В нашем случае так нужно поступить с областью Строка. Остальные значения заполним вручную:

<img src="img/ЗначенияНабораВМакет.png">

## Тестирование

Следующий шаг - это тестирование печатной формы.

Чтобы протестировать форму перейдите на вкладку макет и нажмите кнопку **Тест печатной формы**. Можете производить изменения и делать тестирование пока результат вас не устроит.

:bulb: **Не забывайте обновлять данные Запросов/Наборов при любых изменениях (с помощью кнопки Обновить на соответствующих формах)**

<img src="img/ТестПФ.png">

Когда результат вас полностью устраивает необходимо заблокировать готовую форму с помощью. кнопки **Заблокировать**, чтобы производить тестирование формы уже в текущей информационной базе в соответствующих объектах.

## Экспорт макета во внешнюю печатную форму

Для того чтобы выгрузить готовую печатную форму как внешнюю обработку необходимо в форме списка Макета печатных форм нажать кнопку **Экспорт во внешнюю обработку**.

<img src="img/Экспорт.png">

Чтобы внешняя обработка работала в другой информационной базе необходимо выгрузить ее вместе с урезанной версией расширения. Для этого необходимо активировать ползунок **Расширение** на форме Настроек и заполнить необходимые поля, следуя указаниям.

<img src="img/ЭкспортВФайл.png">